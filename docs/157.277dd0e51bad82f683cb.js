(self.webpackChunknotebookreact=self.webpackChunknotebookreact||[]).push([[157],{9157:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var l=a(7294),s=a(5977),o=a(195),n=a(3727),r=a(9669),u=a.n(r),i=a(9791),d=a(7356),c=a(7267),m=a(2230),v=a(7065);const g=(0,s.EN)((function(e){const t=(0,l.useContext)(c.Z),a=(0,l.useContext)(m.Z),r={title:{value:"",hasErrors:!1,message:""},body:{value:"",hasErrors:!1,message:""},isLoading:!0,saving:{isSaving:!1,btnValue:"save Update"},id:(0,s.UO)().id,sendCount:0,notFound:!1},[g,p]=(0,o.C)((function(e,t){switch(t.type){case"fetchingComplete":return e.title.value=t.value.title,e.body.value=t.value.body,void(e.isLoading=!1);case"titleChange":return e.title.hasErrors=!1,void(e.title.value=t.value);case"bodyChange":return e.body.hasErrors=!1,void(e.body.value=t.value);case"submitRequest":return void(e.title.hasErrors||e.body.hasErrors||e.sendCount++);case"savingStarted":return e.saving.isSaving=!0,void(e.saving.btnValue=t.value);case"savingEnded":return e.saving.isSaving=!1,void(e.saving.btnValue=t.value);case"titleRules":return void(t.value.trim()||(e.title.hasErrors=!0,e.title.message="you must provide a title!"));case"bodyRules":return void(t.value.trim()||(e.body.hasErrors=!0,e.body.message="you must fill in the body!"));case"notFound":return void(e.notFound=!0)}}),r);return(0,l.useEffect)((()=>{const l=u().CancelToken.source();return async function(){try{const s=await u().get(`/post/${g.id}`,{cancelToken:l.token});s.data?(p({type:"fetchingComplete",value:s.data}),t.user.username!=s.data.author.username&&(a({type:"flashMessage",value:{msg:"you don't have permission to edit that post!",mode:"danger"}}),e.history.push("/"))):p({type:"notFound"})}catch(e){console.log("ops, a problem happend!")}}(),()=>l.cancel()}),[]),(0,l.useEffect)((()=>{if(g.sendCount){p({type:"savingStarted",value:"saving ..."});const e=u().CancelToken.source();return async function(){try{await u().post(`/post/${g.id}/edit`,{title:g.title.value,body:g.body.value,token:t.user.token},{cancelToken:e.token}),p({type:"savingEnded",value:"save Update"}),a({type:"flashMessage",value:{msg:"Post has been successfully Updated!",mode:"success"}})}catch(e){console.log("ops, a problem happend!")}}(),()=>e.cancel()}}),[g.sendCount]),g.notFound?l.createElement(v.Z,null):g.isLoading?l.createElement(i.Z,{title:"..."},l.createElement(d.Z,null)):l.createElement(i.Z,{title:"Edit post"},l.createElement(n.rU,{to:`/post/${g.id}`,className:"small font-weight-bold"},"Â« back to permalink"),l.createElement("form",{onSubmit:function(e){e.preventDefault(),p({type:"titleRules",value:g.title.value}),p({type:"bodyRules",value:g.body.value}),p({type:"submitRequest"})}},l.createElement("div",{className:"form-group"},l.createElement("label",{htmlFor:"post-title",className:"text-muted mb-1"},l.createElement("small",null,"Title")),l.createElement("input",{onBlur:e=>p({type:"titleRules",value:e.target.value}),onChange:e=>p({type:"titleChange",value:e.target.value}),value:g.title.value,autoFocus:!0,name:"title",id:"post-title",className:"form-control form-control-lg form-control-title",type:"text",placeholder:"",autoComplete:"off"}),g.title.hasErrors&&l.createElement("div",{className:"alert alert-danger small liveValidateMessage"},g.title.message)),l.createElement("div",{className:"form-group"},l.createElement("label",{htmlFor:"post-body",className:"text-muted mb-1 d-block"},l.createElement("small",null,"Body Content")),l.createElement("textarea",{onBlur:e=>p({type:"bodyRules",value:e.target.value}),onChange:e=>p({type:"bodyChange",value:e.target.value}),value:g.body.value,name:"body",id:"post-body",className:"body-content tall-textarea form-control",type:"text"}),g.body.hasErrors&&l.createElement("div",{className:"alert alert-danger small liveValidateMessage"},g.body.message)),l.createElement("button",{disabled:g.saving.isSaving,className:"btn btn-primary"},g.saving.btnValue)))}))}}]);